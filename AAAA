проблема в ебанных массивах чаров
не нужно шатдаунить клиентский сокет в мастер процессе,ибо клиент не успевает читать данные
проблема, скорее всего, в функции сет, а точнее в выделении памяти с помощью маллока и так далее, 
кажется что неправильное значение возвращает гет или лукап, но я думаю проблема именно в неправильном расположении всей этой памяти где то в очке кучи
